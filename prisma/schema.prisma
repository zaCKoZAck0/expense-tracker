generator client {
  provider   = "prisma-client"
  output     = "./generated"
  engineType = "client"
}

datasource db {
  provider = "postgresql"
}

model Expense {
  id        String         @id @default(uuid())
  amount    Float
  category  String
  date      DateTime
  notes     String?
  type      String         @default("expense") // "expense" or "income"
  isSplit   Boolean        @default(false)
  createdAt DateTime       @default(now())
  userId    String
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  splits    ExpenseSplit[]

  @@index([userId, date])
  @@index([userId, type, date])
  @@index([userId, amount])
}

model User {
  id              String           @id @default(uuid())
  email           String           @unique
  name            String?
  image           String?
  currency        String           @default("USD")
  createdAt       DateTime         @default(now())
  expenses        Expense[]
  savingsBuckets  SavingsBucket[]
  savingsEntries  SavingsEntry[]
  categoryBudgets CategoryBudget[]
  contacts        Contact[]
}

model Contact {
  id        String         @id @default(uuid())
  name      String
  email     String?
  phone     String?
  avatarUrl String?
  createdAt DateTime       @default(now())
  userId    String
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  splits    ExpenseSplit[]

  @@index([userId, name])
}

model ExpenseSplit {
  id          String   @id @default(uuid())
  amount      Float
  percentage  Float?
  isPaid      Boolean  @default(false)
  isYourShare Boolean  @default(false)
  paidByYou   Boolean  @default(true)
  createdAt   DateTime @default(now())
  expenseId   String
  contactId   String?
  expense     Expense  @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  contact     Contact? @relation(fields: [contactId], references: [id], onDelete: SetNull)

  @@index([expenseId])
  @@index([contactId])
}

model Budget {
  id        String   @id @default(uuid())
  amount    Float
  month     String   @unique
  createdAt DateTime @default(now())
}

model CategoryBudget {
  id        String   @id @default(uuid())
  category  String
  amount    Float
  month     String
  createdAt DateTime @default(now())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, month])
  @@index([userId, month])
}

model SavingsBucket {
  id                    String         @id @default(uuid())
  name                  String
  color                 String
  goalAmount            Float?
  interestYearlyPercent Float?
  createdAt             DateTime       @default(now())
  userId                String
  user                  User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries               SavingsEntry[]

  @@index([userId, createdAt])
}

model SavingsEntry {
  id        String        @id @default(uuid())
  amount    Float
  date      DateTime
  entryType String        @default("deposit")
  notes     String?
  createdAt DateTime      @default(now())
  bucketId  String
  userId    String
  bucket    SavingsBucket @relation(fields: [bucketId], references: [id], onDelete: Cascade)
  user      User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([bucketId])
  @@index([userId, date])
}
